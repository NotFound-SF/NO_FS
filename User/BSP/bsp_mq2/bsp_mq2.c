

/*
*********************************************************************************************************
*                                              INCLUDE FILES
*********************************************************************************************************
*/

#include "bsp_mq2.h"
#include "bsp_adc.h"


/*
*********************************************************************************************************
*********************************************************************************************************
**                                         GLOBAL FUNCTIONS
*********************************************************************************************************
*********************************************************************************************************
*/




/*
*********************************************************************************************************
*                                             BSP_MQ2_State()
*
* Description : 获取烟雾传感器状态
*
* Argument(s) : none
*
* Return(s)   : High_Level, Normal_Level
*
* Caller(s)   : Application.
*
* Note(s)     : none.
*********************************************************************************************************
*/
MQ2_State  BSP_MQ2_State (void)
{
	uint8_t   count = 0;
	OS_ERR    err;
	
	if (BSP_ADC_GetDat(BSP_ADC_CH1) > HIGH_LEVEL_VALUE) {
		for (count = 0; count < 10; count++) {
			
			OSTimeDlyHMSM( 0, 0, 0, 4,
		               OS_OPT_TIME_HMSM_STRICT,
                       &err );
			
			if (BSP_ADC_GetDat(BSP_ADC_CH1) < HIGH_LEVEL_VALUE) 
				break;			
		}
	}
	
	if (10 == count)
		return MQ2_High_Level;

	return MQ2_Normal_Level;	
}
